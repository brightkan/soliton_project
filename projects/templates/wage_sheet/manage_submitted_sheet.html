{% extends '../base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load humanize %}

{%block page_title%}
Approve/Reject
{% endblock%}

{% block content %}
<div class="container-fluid">
    <!-- ./row -->
    <div class="row">
        <!-- ./col -->
        <div class="col-12">
            {% comment %} {%if wages%} {% endcomment %}
                <div class="card">
                    <div class="card-body">
                        <h4>Wage Sheet Info</h4>                        
                        <table border="1" cellpadding="5">
                            <tr>
                                <th>Date</th>
                                <td>{{wage_sheet.date}}</td>
                                <th>Field Manager</th>
                                <td>{{wage_sheet.field_manager}}</td>
                                <th>Supervisor</th>
                                <td>{{wage_sheet.supervisor}}</td>
                                <th>Segment</th>
                                <td>{{wage_sheet.segment}}</td>
                            </tr>
                        </table>
                    </div>
                </div>                
                <div class="card card-primary card-outline card-outline-tabs">
                    <div class="card-header p-0 border-bottom-0">
                        <ul class="nav nav-tabs" id="custom-tabs-four-tab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="custom-tabs-four-home-tab" data-toggle="pill" href="#custom-tabs-four-home" role="tab" aria-controls="custom-tabs-four-home" aria-selected="true">Wages</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="custom-tabs-four-profile-tab" data-toggle="pill" href="#custom-tabs-four-profile" role="tab" aria-controls="custom-tabs-four-profile" aria-selected="false">Complaints</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="custom-tabs-four-messages-tab" data-toggle="pill" href="#custom-tabs-four-messages" role="tab" aria-controls="custom-tabs-four-messages" aria-selected="false">Deductions</a>
                        </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="custom-tabs-four-tabContent">
                        <div class="tab-pane fade show active" id="custom-tabs-four-home" role="tabpanel" aria-labelledby="custom-tabs-four-home-tab">                            
                            <table id="example1" class="table table-striped">
                                <thead>
                                <tr>
                                    <th>Wage ID</th>
                                    <th>Worker</th>
                                    <th>Project</th>
                                    <th>Activity</th>
                                    <th>Quantity</th>
                                    <th>Payment</th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for wage in wages%}
                                <tr>
                                    <td>{{wage.id}}</td>
                                    <td>{{wage.worker}}</td>
                                    <td>
                                        {{wage.pip_activity.scope.survey.project}}
                                    </td>
                                    <td>
                                        {{wage.pip_activity.activity}}
                                    </td>
                                    <td>{{wage.quantity}}</td>
                                    <td>UGX {{wage.payment | intcomma}}</td>
                                    <td>
                                        
                                    <td>
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>

                            <br/>
                            <table class="table table-small">                        
                                <form method="POST" id="approve_wage_form" action="{% url 'approve_reject_wagesheet' wage_sheet.id %}" > 
                                    {% csrf_token %}
                                    <input type="hidden" id="wage_sheet_id" name="wage_sheet_id" value="{{wage_sheet.id}}">
                                    <input type="hidden" id="role" name="role" value="{{role}}">

                                    {% if role == 1 %}
                                        <tr>
                                            <th scope="row">Manager Status:</th>
                                            <td>
                                                {% if wage_sheet.manager_status %}
                                                    Approved
                                                {% endif %}
                                            </td>
                                            <th scope="row">Manager Comment:</th>
                                            <td>{{wage_sheet.manager_comment}}</td>
                                        </tr>
                                    {% elif role == 2%}
                                        <tr>
                                            <th scope="row">Manager Status:</th>
                                            <td>
                                                {% if wage_sheet.manager_status %}
                                                    Approved
                                                {% endif %}
                                            </td>
                                            <th scope="row">Manager Comment:</th>
                                            <td>{{wage_sheet.manager_comment}}</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">PM Status:</th>
                                            <td>{{wage_sheet.project_manager_status}}</td>
                                            <th scope="row">PM Comment:</th>
                                            <td>{{wage_sheet.project_manager_comment}}</td>
                                        </tr>
                                    {% elif role == 3%}
                                        <tr>
                                            <th scope="row">Manager Status:</th>
                                            <td>
                                                {% if wage_sheet.manager_status %}
                                                    Approved
                                                {% endif %}
                                            </td>
                                            <th scope="row">Manager Comment:</th>
                                            <td>{{wage_sheet.manager_comment}}</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">PM Status:</th>
                                            <td>{{wage_sheet.project_manager_status}}</td>
                                            <th scope="row">PM Comment:</th>
                                            <td>{{wage_sheet.project_manager_comment}}</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">GM Status:</th>
                                            <td>{{wage_sheet.gm_status}}</td>
                                            <th scope="row">GM Comment:</th>
                                            <td>{{wage_sheet.gm_comment}}</td>
                                        </tr>

                                    {% endif %}

                                    <!-- Approval -->                                    
                                    <tr>
                                        <th>Action:</th>
                                        <td>                                            
                                            <div class="form-group ">
                                                <select id="wage_action" class="form-control" name="wage_action">                             
                                                    <option>--- Choose Action ---</option>                                                
                                                    <option value="1">Approve</option>
                                                    <option value="0">Reject</option>                                                                                     
                                                </select>
                                            </div>
                                        </td>
                                        <th>Comment:</th>
                                        <td>
                                            <div class="form-group green-border-focus">
                                                <textarea class="form-control" name="wage_comment" id="wage_comment">                                                
                                                </textarea>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan=4>
                                            <button class="btn btn-primary btn-lg btn-block" type="submit" id="submit_wage_approval">
                                                Submit
                                            </button>
                                        </td>
                                    </tr>
                                </form>
                            </table>
                        </div>
                        <div class="tab-pane fade" id="custom-tabs-four-profile" role="tabpanel" aria-labelledby="custom-tabs-four-profile-tab">
                            Complaints
                        </div>
                        <div class="tab-pane fade" id="custom-tabs-four-messages" role="tabpanel" aria-labelledby="custom-tabs-four-messages-tab">
                            Deductions
                        </div>
                        </div>
                    </div>
                    <!-- /.card -->
                </div>
            {% comment %} {% else %}                
                <div class="card">
                    <div class="card-body">
                        <h4>Wage sheet is Empty</h4>
                    </div>
                </div>
            {%endif%} {% endcomment %}
        </div>
        <!-- /.col -->
    </div>
    <!-- /.row -->
</div>
<!-- /.container-fluid -->

<!-- DataTables -->
<script src="{% static 'plugins/datatables/jquery.dataTables.min.js'%}"></script>
<script src="{% static 'plugins/datatables-bs4/js/dataTables.bootstrap4.min.js'%}"></script>
<script src="{% static 'plugins/datatables-responsive/js/dataTables.responsive.min.js'%}"></script>
<script src="{% static 'plugins/datatables-responsive/js/responsive.bootstrap4.min.js'%}"></script>

<!-- page script -->
<script>
  $(function () {
    $("#example1").DataTable({
      "responsive": true,
      "autoWidth": false,
    });
    $('#example2').DataTable({
      "paging": true,
      "lengthChange": false,
      "searching": false,
      "ordering": true,
      "info": true,
      "autoWidth": false,
      "responsive": true,
    });
  });
</script>
{% endblock content %}